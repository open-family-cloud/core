# ============================================================
# Open Family Cloud — ブートストラップ設定
#
# 全ての設定をこのファイルに記入し、bootstrap.sh で一括デプロイします。
#
#   cp bootstrap.example.conf bootstrap.conf
#   vim bootstrap.conf
#   ./scripts/bootstrap.sh bootstrap.conf
#
# 注意: パスワードに $ や ! を含む場合はシングルクォートで囲んでください
#   例: LDAP_ADMIN_PASSWORD='pa$$w0rd!'
# ============================================================

# === プロバイダ選択 ===
PROVIDER="vultr"                        # vultr または linode

# === Vultr 設定 (PROVIDER=vultr の場合) ===
VULTR_API_KEY=""                        # https://my.vultr.com/settings/#settingsapi
VULTR_REGION="nrt"                      # nrt=東京, icn=ソウル, etc.
VULTR_PLAN="vc2-2c-4gb"                 # compose: vc2-2c-4gb / k8s: vc2-4c-8gb
VULTR_OS_ID=2284                        # 2284 = Ubuntu 24.04 LTS
VULTR_OBJECT_STORAGE_CLUSTER=16         # Object Storage クラスタ ID (数値。確認: curl -H "Authorization: Bearer $VULTR_API_KEY" https://api.vultr.com/v2/object-storage/clusters | jq)
VULTR_OBJECT_STORAGE_TIER=1             # 1=Performance (デフォルト)

# === Linode 設定 (PROVIDER=linode の場合) ===
LINODE_TOKEN=""                         # https://cloud.linode.com/profile/tokens
LINODE_REGION="ap-northeast"            # ap-northeast=東京
LINODE_PLAN="g6-standard-2"             # compose: g6-standard-2 / k8s: g6-standard-4
LINODE_IMAGE="linode/ubuntu24.04"
LINODE_ROOT_PASS=""                     # 初回のみ使用 (cloud-init でパスワード認証無効化)
LINODE_OBJECT_STORAGE_REGION="ap-south-1"

# === Cloudflare ===
CLOUDFLARE_API_TOKEN=""                 # https://dash.cloudflare.com/profile/api-tokens
CLOUDFLARE_ZONE_ID=""                   # ダッシュボード → ドメイン → 概要 → ゾーン ID
CLOUDFLARE_PROXIED=false                # true: CDN/WAF 有効 (mail は自動除外)

# === SSH ===
SSH_PUBLIC_KEY_PATH="$HOME/.ssh/id_ed25519.pub"
SSH_PRIVATE_KEY_PATH="$HOME/.ssh/id_ed25519"

# === ドメイン ===
DOMAIN="example.com"
ACME_EMAIL="admin@example.com"
TZ="Asia/Tokyo"

# === デプロイパターン ===
DEPLOY_PATTERN="compose"                # compose または k8s

# === ストレージ ===
BLOCK_STORAGE_SIZE_GB=40
# S3_BUCKET_PREFIX=""                   # 空ならドメイン名ベースで自動生成 (example.com → example-com-nextcloud, etc.)

# === OpenLDAP ===
LDAP_ORGANISATION="Family Cloud"
LDAP_ADMIN_PASSWORD="changeme-ldap-admin"
LDAP_CONFIG_PASSWORD="changeme-ldap-config"

# === PostgreSQL ===
POSTGRES_PASSWORD="changeme-postgres"
POSTGRES_NEXTCLOUD_PASSWORD="changeme-nc-db"
POSTGRES_SYNAPSE_PASSWORD="changeme-synapse-db"
POSTGRES_VAULTWARDEN_PASSWORD="changeme-vw-db"

# === Nextcloud ===
NEXTCLOUD_ADMIN_USER="admin"
NEXTCLOUD_ADMIN_PASSWORD="changeme-nextcloud"

# === Matrix Synapse ===
# SYNAPSE_SERVER_NAME は未設定の場合 DOMAIN と同じ値になります
# SYNAPSE_SERVER_NAME="example.com"

# === Jitsi Meet ===
JITSI_SECRET_JICOFO_COMPONENT="changeme-jicofo-component"
JITSI_SECRET_JICOFO_AUTH="changeme-jicofo-auth"
JITSI_SECRET_JVB_AUTH="changeme-jvb-auth"

# === Vaultwarden ===
# 平文トークンを設定 → bootstrap.sh が自動で Argon2id ハッシュ化して .env に書き込みます
# ブラウザで /admin にログインする際はここに設定した平文トークンを使います
# 生成例: openssl rand -hex 32
VAULTWARDEN_ADMIN_TOKEN="changeme-vaultwarden-admin"

# === バックアップ ===
BACKUP_ENCRYPTION_KEY="changeme-backup-encryption"

# === Firewall ===
ALLOWED_SSH_CIDRS="0.0.0.0/0"          # カンマ区切りで複数指定可: "1.2.3.4/32,5.6.7.8/32"

# === Git ===
GIT_REPO="https://github.com/open-family-cloud/core.git"
GIT_BRANCH="main"

# === VPS ===
VPS_LABEL="ofc-server"
SSH_USER="ofc"                          # cloud-init で作成されるユーザー名
